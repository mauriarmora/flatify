<%= render '/shared/navbar' %>

<div class="container">
  <div class="header-flex">
    <%= link_to '<i class="fas fa-arrow-left back-arrow"></i>'.html_safe, dashboard_path  %>
    <h1 id="homepage-title">New expense</h1>
  </div>

  <div class="form-post">
    <%= simple_form_for([@flat, @expense]) do |f| %>

      <div class="category-choices">
        <% Expense::CATEGORIES.each do |category| %>
          <input type="radio" class="hidden" value="<%= category %>" name="expense[category]" id="post_category_<%= category %>">
          <label data-color="<%= Expense.map_cat_to_color(category) %>" class="category-choice" for="post_category_<%= category %>" style="color: <%= Expense.map_cat_to_color(category) %>" style="border-color: <%= Expense.map_cat_to_color(category) %>">
            <%= category %>
          </label>
        <% end %>
      </div>

      <div class="error">
        <%= f.full_error(:category) %>
      </div>
      <%= f.input :amount, label: false, label_html: { class: "label-fonts" }, input_html: { class: "details-box" }, placeholder: "0.00â‚¬" %>
      <%= f.input :description, label: false, as: :text, placeholder: "E.g. Bought more beers for the fridge." %>

      <div class="d-flex justify-content-between">
        <%= f.input :payment_month,  collection: Expense::MONTHS, selected: Date.today.strftime("%B"),label: false, input_html: { class: "wide-input-dates" }, include_blank: false %>
        <!---- start_year: Date.today.year - 1, end_year: Date.today.year + 1 --->
        <%= f.input :payment_year, label: false, collection: (Date.today.year - 1..Date.today.year + 1), selected: Date.today.year, include_blank: false, input_html: {class: "wide-input-dates" }  %>
      </div>

      <div class="flatmates-choices">
        <h3>Share with</h3>

      <div class="new-mate-card position-relative">
        <div class="mate-card-complete user-container">
          <% @flat.users.each do |user| %>
            <input type="checkbox" class="hidden" value="<%= user.id %>" name="user_expense[user][]" id="user_<%= user.id %>">
            <label for="user_<%= user.id %>">
              <div class="add-mate-card">
                <div class="small-avatar" style="background-image: url(<%= user.photo_url %>)" alt=""></div>
                <h5> <%= user.first_name %> </h5>
              </div>
            </label>
          <% end %>
        </div>
      </div>

      <div class="error">
        <%= f.full_error(:flatmates) %>
      </div>

      <div class="add-photo mt-3 mb-3">
        <%= f.input :photo, as: :file, input_html: { class: 'd-none', id: 'photo-input' }, label_html: { class: 'upload-photo' }, label: '<i class="fas fa-cloud-upload-alt fa-2x"></i><h3 class="ml-2 mt-2 flatmate-name">Upload photo</h3>'.html_safe %>
      </div>
      <div class="display-photo-middle">
        <%= image_tag "", width: 300, class: "hidden", id: "photo-preview" %>
      </div>

      <div class="expense-button">
        <%= f.submit class: "primarybtn expense-button-centered" %>
      </div>

    <% end %>

  </div>
</div>
