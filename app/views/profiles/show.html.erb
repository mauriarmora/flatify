<%= render 'shared/navbar' %>

<div class="big-avatar" style="background-image: url(<%= @user.photo_url %>)"></div>
<div class="wrapper-profile">

  <div class="container">

    <h3 class="text-center"><%= @user.first_name %> <%= @user.last_name %></h3>
    <% if params[:date].nil? %>
      <h2>This are all your expenses</h2>
    <% else %>
      <h2>This are all your expenses for <%= @month %></h2>
    <% end %>

    <div class="chart mb-4">
      <% Expense::MONTHS[2..7] %>
      <% data = UserExpense.joins(:expense).where("user_expenses.user_id = ?", @user.id).where("expenses.payment_month" => Expense::MONTHS[5..9]).group("expenses.payment_month").sum("expenses.amount") %>
      <%= column_chart data, stacked: true, height: '200px', messages: {empty: "No expenses"} %>
    </div>

    <div class="categories d-flex mb-5 mt-2 justify-content-around">
      <% @categories.each do |category| %>
        <div class="category d-flex align-items-center py-4">
          <i class="fas fa-circle circle-<%= category.downcase %> mr-1"></i>
          <p class="mb-0"><%= category %></p>
        </div>
      <% end %>
    </div>

    <div class="expenses">
      <% @user_expenses.each do |user_expense| %>
        <%= link_to flat_expense_path(user_expense.user.flat, user_expense.expense) do %>
          <div class="expense-card mt-2">
            <div class="expense-content">
              <div class="expense-category-<%= user_expense.expense.category.downcase %>"></div>
              <div class="expense-info">
                <p class="description"><%= user_expense.expense.description %></p>
                <p class="mb-0">â‚¬ <%= format_cost(user_expense.expense.amount) %></p>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>

  </div>
</div>
